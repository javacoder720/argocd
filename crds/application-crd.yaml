apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: applications.example.com
  annotations:
    description: "Custom Resource Definition for managing applications"
spec:
  group: example.com
  scope: Namespaced
  names:
    plural: applications
    singular: application
    kind: Application
    shortNames:
      - app
    categories:
      - all
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          description: "Application is a custom resource for deploying applications"
          required: ["spec"]
          properties:
            spec:
              type: object
              description: "Specification of the desired application state"
              required: ["image"]
              properties:
                image:
                  type: string
                  description: "Container image (e.g., nginx:1.21)"
                  pattern: '^[a-zA-Z0-9._/-]+:[a-zA-Z0-9._-]+$'
                replicas:
                  type: integer
                  description: "Number of replicas"
                  minimum: 1
                  maximum: 10
                  default: 1
                port:
                  type: integer
                  description: "Container port to expose"
                  minimum: 1
                  maximum: 65535
                  default: 80
                environment:
                  type: string
                  description: "Environment name"
                  enum: ["dev", "staging", "prod"]
                  default: "dev"
                resources:
                  type: object
                  description: "Resource requirements"
                  properties:
                    cpu:
                      type: string
                      description: "CPU request (e.g., 100m, 1)"
                      default: "100m"
                    memory:
                      type: string
                      description: "Memory request (e.g., 128Mi, 1Gi)"
                      default: "128Mi"
            status:
              type: object
              description: "Observed state of the application"
              properties:
                availableReplicas:
                  type: integer
                  description: "Number of available replicas"
                conditions:
                  type: array
                  description: "Current conditions"
                  items:
                    type: object
                    required: ["type", "status"]
                    properties:
                      type:
                        type: string
                        description: "Condition type (e.g., Ready, Progressing)"
                      status:
                        type: string
                        description: "Status of the condition (True, False, Unknown)"
                        enum: ["True", "False", "Unknown"]
                      reason:
                        type: string
                        description: "One-word CamelCase reason for the condition"
                      message:
                        type: string
                        description: "Human-readable message"
                      lastTransitionTime:
                        type: string
                        format: date-time
                        description: "Last time the condition transitioned"
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Image
          type: string
          description: "Container image"
          jsonPath: .spec.image
        - name: Replicas
          type: integer
          description: "Desired replicas"
          jsonPath: .spec.replicas
        - name: Available
          type: integer
          description: "Available replicas"
          jsonPath: .status.availableReplicas
        - name: Environment
          type: string
          description: "Environment"
          jsonPath: .spec.environment
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
